import{d as ge,a as f,c as ye,j as we,o as L,b as V,e as p,v as I,C as Me,D as _e,n as N,f as x,w as C,F as Q,l as Z,u as y,t as Se,K,_ as Pe}from"./index-C8_KvqLc.js";import{M as Ie}from"./MjButton-BmN55pLQ.js";import{m as Ce}from"./MjMessage-B6PxiNxc.js";import{M as W}from"./MjTable-D9Fewee_.js";import{M as Y}from"./index-D5Ao2_O2.js";import{B as X}from"./BinaryWriter-4Snmgu5s.js";import{s as De}from"./index-C1s-hTSf.js";import{d as ke}from"./date-BJ_dEscf.js";import"./LoadingIcon.vue_vue_type_script_setup_true_lang-Cjl4ccjb.js";import"./MjCheckbox-CRx5YV5s.js";import"./index-V9QYX3jy.js";const Ee={class:"draw-circle"},Te={class:"draw-circle-container"},be={class:"draw-circle-status-bar"},Be={class:"draw-circle-dialog"},$e={class:"draw-curcle-curr-record"},Fe={class:"draw-circle-record"},u=400,Re=180,Le=ge({__name:"DrawCircle",setup(Ve){const T=Y.Panel,j=[[95,"画圆大神"],[90,"画圆大师"],[85,"画圆大王"],[80,"画圆高手"],[75,"平均水平"],[70,"低于平均"]],U=[[95,"#f00"],[90,"#ffa500"],[85,"#ae00ff"],[80,"#0085ff"],[75,"#26ef26"],[70,"#000"]],w={x:u/2,y:u/2},h=[60,70,80,90,100],ee=e=>{for(let a=0;a<j.length;a++)if(e>=j[a][0])return j[a][1];return"差距太大"},b=e=>{for(let a=0;a<U.length;a++)if(e>=U[a][0])return U[a][1];return"#000"},ae=h.reduce((e,a)=>({...e,[`radius${a}`]:[]}),{pi:[],score:[],maxScore:[]}),n=f(ae),te=()=>{const e=localStorage.getItem("game-drawcircle")||"";if(!e)return;const a=new X("Read",1);a.setRawData(e);const l={pi:[],score:[],maxScore:[]},s=["pi","score","maxScore"].concat(h.map(t=>`radius${t}`));a.readInt16(),s.forEach(t=>{l[t]=a.readArray(r=>{const i={pi:0,time:0,score:0,max:0,min:0};return(t==="score"?["time","score","max","min"]:t==="maxScore"||t==="pi"?["score","pi","time","radius"]:["score","pi","time"]).forEach(d=>{d==="time"?i[d]=Number(r.readBigUint64()):d==="radius"?i[d]=r.readInt16():i[d]=r.readFloat64()}),i})}),n.value={...n.value,...l}},le=()=>{const e=new X("Write",1e4);e.writeInt16(1),["pi","score","maxScore"].concat(h.map(l=>`radius${l}`)).forEach(l=>{e.writeArray([...n.value[l]],(s,t)=>{(l==="score"?["time","score","max","min"]:l==="maxScore"||l==="pi"?["score","pi","time","radius"]:["score","pi","time"]).forEach(r=>{r==="time"?t.writeBigUInt64(BigInt(s[r])):r==="radius"?t.writeInt16(s[r]||0):t.writeFloat64(s[r])})})}),localStorage.setItem("game-drawcircle",e.getRawDataStr())},B={pi:{name:"pi",title:"π",align:"center",formatter:e=>e.toFixed(7)},time:{name:"time",title:"日期",formatter:e=>ke("YYYY-MM-DD HH:mm:ss",new Date(e)),width:200,align:"center"},score:{name:"score",title:"得分",align:"center",render:({value:e})=>K("span",{style:{color:b(e)}},[e.toFixed(2)])},max:{name:"max",title:"最佳得分",width:100,align:"center",render:({value:e})=>K("span",{style:{color:b(e)}},[e.toFixed(2)])},min:{name:"min",title:"最差得分",width:100,align:"center",render:({value:e})=>K("span",{style:{color:b(e)}},[e.toFixed(2)])},radius:{name:"radius",title:"半径",width:100,align:"center",formatter:e=>e||"-"}},se=["pi","time","score","radius"].map(e=>B[e]),oe=["score","time","max","min"].map(e=>B[e]),re=["score","time","pi","radius"].map(e=>B[e]),ie=["score","time","pi"].map(e=>B[e]),D=f(),o=f(),c=f([]),v=f(0),$=f(!1),q=f(!0),F=f(!1),g=f(!1),m=f([]),_=f([]),S=f({left:0,top:0}),ne=(e,a,l,s,t,r,i,d)=>{if(e===l&&a===s||t===i&&r===d)return!1;let M=0;if(M=(d-r)*(l-e)-(i-t)*(s-a),M===0)return!1;let P=((i-t)*(a-r)-(d-r)*(e-t))/M,R=((l-e)*(a-r)-(s-a)*(e-t))/M;return P<0||P>1||R<0||R>1?!1:{x:e+P*(l-e),y:a+P*(s-a)}},k=(e,a)=>{var l=e.x-a.x,s=e.y-a.y;return Math.sqrt(l*l+s*s)},ce=async(e,a)=>{if(!g.value){let l=0;for(let t=0;t<e.length;t++){const r=e[t];r[0]&&r[1]&&(l+=k(r[0],r[1])/(a/2))}const s=100-l/e.length*100;m.value.push(Number(s))}if(o.value){let l=0;const s=async()=>{const t=e[l];if(t[0]){const[r,i]=t;o.value.strokeStyle="black",o.value.beginPath(),o.value.moveTo(r.x,r.y),o.value.lineTo(i.x,i.y),o.value.stroke()}else{const[,r,i]=t;o.value.strokeStyle="red",o.value.beginPath(),o.value.moveTo(r.x,r.y),o.value.lineTo(i.x,i.y),o.value.stroke()}l++,l<e.length&&(await De(16),await s())};await s(),o.value.strokeStyle="red"}},A=ye(()=>m.value.length>0?m.value.reduce((e,a)=>e+a,0)/m.value.length:0),ue=async()=>{const e=u/2,a=h[v.value];let l=130;const s=360/Re,t=[];for(g.value=!1;l!==-230;){const r=Math.sin(l*(Math.PI/180)),i=Math.cos(l*(Math.PI/180)),d=w.x+e*r,M=w.y+e*i,P=w.x+a*r,R=w.y+a*i;let G=!0;for(let E=0;E<c.value.length;E++){const J=c.value[E],O=c.value[E===c.value.length-1?0:E+1],z=ne(w.x,w.y,d,M,J.x,J.y,O.x,O.y);if(z){G=!1,t.push([{x:P,y:R},{x:z.x,y:z.y}]);break}}G&&(g.value=!0,t.push([null,{...w},{x:d,y:M}])),l-=s}await ce(t,a)},ve=(e=5)=>{let a=[c.value[0]];for(let t=1;t<c.value.length;t++)k(a[a.length-1],c.value[t])>e&&a.push(c.value[t]);let l=0;for(let t=0;t<a.length-1;t++)l+=k(a[t],a[t+1]);l+=k(a[a.length-1],a[0]);let s=0;for(let t=0;t<a.length;t++)for(let r=t+1;r<a.length;r++){const i=k(a[t],a[r]);i>s&&(s=i)}return l/s},H=()=>{if(o.value){const e=h[v.value];c.value=[],o.value.clearRect(0,0,u,u),o.value.beginPath(),o.value.arc(u/2,u/2,5,0,Math.PI*2),o.value.fillStyle="gray",o.value.fill(),o.value.beginPath(),o.value.moveTo(u/2,u/2),o.value.lineTo(u/2+Math.cos(Math.PI/180*310)*e,u/2+Math.sin(Math.PI/180*310)*e),o.value.strokeStyle="green",o.value.lineWidth=2,o.value.stroke(),o.value.lineWidth=1,o.value.strokeStyle="red"}},me=()=>{F.value=!1,v.value=0,m.value=[],_.value=[],H()},de=()=>{v.value<4?(g.value||v.value++,F.value=!1,H()):me()},fe=e=>{var a;q.value&&(S.value=(a=D.value)==null?void 0:a.getBoundingClientRect(),$.value=!0,q.value=!1,c.value.push({x:e.clientX-S.value.left,y:e.clientY-S.value.top}))},pe=e=>{if($.value){const a=c.value[c.value.length-1],l={x:e.clientX-S.value.left+Math.random()*.01*(Math.random()>.5?1:-1),y:e.clientY-S.value.top+Math.random()*.01*(Math.random()>.5?1:-1)};Math.sqrt((a.x-l.x)*(a.x-l.x)+(a.y-l.y)*(a.y-l.y))>0&&(c.value.push(l),o.value.beginPath(),o.value.moveTo(a.x,a.y),o.value.lineTo(l.x,l.y),o.value.stroke())}},he=()=>{Ce.success(`${ee(A.value)}`);const e=Math.max(...m.value),a=Math.min(...m.value),l=Date.now();n.value.pi.push(..._.value.map((s,t)=>({pi:s,time:l,score:m.value[t],radius:h[t]}))),n.value.pi.sort((s,t)=>t.pi===s.pi?s.time-t.time:Math.abs(s.pi-Math.PI)-Math.abs(t.pi-Math.PI)),n.value.pi=n.value.pi.slice(0,10),n.value.score.push({time:l,score:A.value,max:e,min:a}),n.value.score.sort((s,t)=>t.score===s.score?s.time-t.time:t.score-s.score),n.value.score=n.value.score.slice(0,10),n.value.maxScore.push(..._.value.map((s,t)=>({pi:s,time:l,score:m.value[t],radius:h[t]}))),n.value.maxScore.sort((s,t)=>t.score===s.score?s.time-t.time:t.score-s.score),n.value.maxScore=n.value.maxScore.slice(0,10),h.forEach((s,t)=>{n.value[`radius${s}`].push({pi:_.value[t],time:l,score:m.value[t]}),n.value[`radius${s}`].sort((r,i)=>i.score===r.score?r.time-i.time:i.score-r.score),n.value[`radius${s}`]=n.value[`radius${s}`].slice(0,10)}),le()},xe=async()=>{if($.value){$.value=!1;const e=c.value[c.value.length-1],a=c.value[0];if(o.value.beginPath(),o.value.moveTo(e.x,e.y),o.value.lineTo(a.x,a.y),o.value.stroke(),o.value.beginPath(),o.value.strokeStyle="black",o.value.arc(u/2,u/2,h[v.value],0,Math.PI*2),o.value.stroke(),o.value.strokeStyle="red",await ue(),q.value=!0,!g.value){const l=ve();_.value.push(l),v.value===4&&he()}F.value=!0}};return te(),we(()=>{var e,a;o.value=(e=D.value)==null?void 0:e.getContext("2d"),S.value=(a=D.value)==null?void 0:a.getBoundingClientRect(),D.value.addEventListener("mousedown",fe),window.addEventListener("mousemove",pe),window.addEventListener("mouseup",xe),H()}),(e,a)=>(L(),V("div",Ee,[p("div",Te,[p("div",be,[p("span",null,I(v.value+1)+" / 5",1),p("span",null,I(Math.floor(A.value)),1)]),p("canvas",{ref_key:"canvas",ref:D,width:"400",height:"400"},null,512),Me(p("div",Be,[p("div",{class:"draw-circle-score-curr",style:N({opacity:g.value?0:1})},I((m.value[v.value]||0).toFixed(2)),5),p("div",{class:"draw-circle-pi",style:N({opacity:g.value?0:1})}," π="+I(_.value[v.value]),5),p("div",{class:"draw-circle-message",style:N({opacity:g.value?1:0})},"这根本不是圆！",4),x(Ie,{type:"primary",status:"danger",onClick:de},{default:C(()=>[Se(I(g.value?"重画":v.value===4?"再来一次":"下一个"),1)]),_:1})],512),[[_e,F.value]]),p("div",$e,[(L(!0),V(Q,null,Z(m.value.slice(0,v.value),(l,s)=>(L(),V("dl",{key:`curr-${s}`,style:N({color:b(l)})},I(l.toFixed(2)),5))),128))])]),p("div",Fe,[x(y(Y),{"default-active-key":"score"},{default:C(()=>[x(y(T),{title:"分数",key:"score"},{default:C(()=>[x(W,{columns:y(oe),data:n.value.score},null,8,["columns","data"])]),_:1}),x(y(T),{title:"π",key:"pi"},{default:C(()=>[x(W,{columns:y(se),data:n.value.pi},null,8,["columns","data"])]),_:1}),x(y(T),{title:"单次分数",key:"maxScore"},{default:C(()=>[x(W,{columns:y(re),data:n.value.maxScore},null,8,["columns","data"])]),_:1}),(L(),V(Q,null,Z(h,l=>x(y(T),{title:`半径${l}`,key:`radius${l}`},{default:C(()=>[x(W,{columns:y(ie),data:n.value[`radius${l}`]},null,8,["columns","data"])]),_:2},1032,["title"])),64))]),_:1})])]))}}),Oe=Pe(Le,[["__scopeId","data-v-f2bc7ce7"]]);export{Oe as default};
