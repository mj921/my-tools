import{M as Mt}from"./MjSlider-CnvDmUfS.js";import{M as vt}from"./MjCheckbox-CRx5YV5s.js";import{M as W}from"./MjButton-BmN55pLQ.js";import{M as xt}from"./MjModal-D8GbfQV7.js";import{d as It,a as B,o as X,b as Y,e as P,f as $,w as J,F as Z,l as tt,n as bt,s as Ft,t as et,v as N,_ as Ct}from"./index-C8_KvqLc.js";import"./LoadingIcon.vue_vue_type_script_setup_true_lang-Cjl4ccjb.js";import"./CloseIcon.vue_vue_type_script_setup_true_lang-BO1-knco.js";function st(e,t){return[nt(e),nt(t)]}function nt(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const ct=e=>{const t=e.width,r=e.height,[s,o]=st(t,r),a=lt(e,s,o);return{fftData:it(a,s,o),width:s,height:o}};function _t(e){const t=e.width,r=e.height,[s,o]=st(t,r),a=lt(e,s,o),u=it(a,s,o);return kt(u,s,o,t,r)}function lt(e,t,r){const s=e.data,o=Math.floor((t-e.width)/2),a=Math.floor((r-e.height)/2),u=new Array(r);for(let w=0;w<r;w++)if(u[w]=new Array(t).fill(0),w>=a&&w<e.height+a)for(let g=0;g<e.width;g++){const C=((w-a)*e.width+g)*4;u[w][g+o]=.299*s[C]+.587*s[C+1]+.114*s[C+2]}return u}function it(e,t,r){const s=e.map(a=>ot(a.map(u=>({re:u,im:0})),t)),o=Q(s).map(a=>ot(a.map(u=>u),r));return Q(o)}function z(e){const t=e.length;if(t<=1)return e;const r=z(e.filter((a,u)=>u%2===0)),s=z(e.filter((a,u)=>u%2===1)),o=new Array(t).fill({re:0,im:0});for(let a=0;a<Math.floor(t/2);a++){const u=-2*Math.PI*a/t,w={re:Math.cos(u),im:Math.sin(u)},g=K(w,s[a]);o[a]=At(r[a],g),o[a+t/2]=Ut(r[a],g)}return o}function ut(e){return e&&(e&e-1)===0}function H(e){const t=e.length;if(t<=1)return e;const r=e.map(o=>({re:o.re,im:-o.im}));let s;return ut(t)?s=z(r):s=dt(r,t),s.map(o=>({re:o.re/t,im:o.im/t}))}function dt(e,t){const r=e.length,s=Math.ceil(Math.log2(t+r-1)),o=Math.pow(2,s),a=new Array(o).fill({re:0,im:0}),u=new Array(o).fill({re:0,im:0});for(let f=0;f<r;f++){const m=Math.PI*f*f/t;a[f]=K(e[f],{re:Math.cos(m),im:-Math.sin(m)})}for(let f=0;f<o;f++){const m=Math.PI*(f%(2*t))*(f%(2*t))/t;u[f]={re:Math.cos(m),im:Math.sin(m)}}const w=z(a),g=z(u),C=w.map((f,m)=>K(f,g[m])),x=H(C).slice(0,t),_=new Array(t);for(let f=0;f<t;f++){const m=Math.PI*f*f/t,p={re:Math.cos(m),im:-Math.sin(m)};_[f]=K(x[f],p)}return _}function kt(e,t,r,s,o){const a=new ImageData(t,r),u=new Float32Array(t*r);let w=-1/0,g=1/0;for(let m=0;m<r;m++)for(let p=0;p<t;p++){const U=(m+r/2)%r*t+(p+t/2)%t,D=Math.log(1+Math.hypot(e[m][p].re,e[m][p].im));u[U]=D,w=Math.max(w,D),g=Math.min(g,D)}const C=w-g||1;for(let m=0;m<u.length;m++){const p=(u[m]-g)/C*255;a.data[4*m]=a.data[4*m+1]=a.data[4*m+2]=p,a.data[4*m+3]=255}const x=Math.floor((t-s)/2),_=Math.floor((r-o)/2),f=new ImageData(s,o);for(let m=0;m<o;m++)for(let p=0;p<s;p++){const U=(m+_)%r*t+(p+x)%t,D=(m*s+p)*4;f.data[D]=f.data[D+1]=f.data[D+2]=a.data[U*4],f.data[D+3]=255}return f}function ot(e,t){const r=e.length;return r===t&&ut(r)?z(e):dt(e,t)}function Q(e){return e[0].map((t,r)=>e.map(s=>s[r]))}function At(e,t){return{re:e.re+t.re,im:e.im+t.im}}function Ut(e,t){return{re:e.re-t.re,im:e.im-t.im}}function K(e,t){return{re:e.re*t.re-e.im*t.im,im:e.re*t.im+e.im*t.re}}function Dt(e,{width:t,height:r,originHeight:s,originWidth:o},a={}){const{type:u="gaussian",cutoff:w=600,radius:g=20}=a,C=jt(t,r,{type:u,cutoff:w,radius:g}),x=Lt(e,t,r,C),_=ft(x);return mt(_,o,s)}const at=(e,t={})=>{const{fftData:r,width:s,height:o}=ct(e);return Dt(r,{width:s,height:o,originWidth:e.width,originHeight:e.height},t)},Tt=e=>{const{fftData:t}=ct(e),r=ft(t);return mt(r,e.width,e.height)};function jt(e,t,r){const s=e/2,o=t/2,a=new Array(t).fill(0).map(()=>new Array(e));let u=0,w=0;for(let g=0;g<t;g++)for(let C=0;C<e;C++){const x=C-s,_=g-o,f=Math.sqrt(x*x+_*_);switch(r.type){case"ideal":a[g][C]=f<=r.cutoff?1:0,u+=a[g][C],w++;break;case"gaussian":a[g][C]=Math.exp(-(f**2)/(2*r.radius**2));break}}return console.log(r.type,r.cutoff,r.radius,u,w,Math.log2(e)),a}function Lt(e,t,r,s){const o=new Array(r);for(let a=0;a<r;a++){o[a]=new Array(t);for(let u=0;u<t;u++)o[a][u]={re:e[a][u].re*s[a][u],im:e[a][u].im*s[a][u]}}return o}function ft(e){const r=Q(e).map(o=>H(o));return Q(r).map(o=>H(o))}function mt(e,t,r){var C;const s=new ImageData(t,r);let o=1/0,a=-1/0;const u=Math.floor(((((C=e==null?void 0:e[0])==null?void 0:C.length)||0)-t)/2),w=Math.floor((e.length-r)/2);for(let x=0;x<r;x++)for(let _=0;_<t;_++){const f=e[x][_].re;o=Math.min(o,f),a=Math.max(a,f)}const g=a-o||1;for(let x=0;x<r;x++)for(let _=0;_<t;_++){const f=(x*t+_)*4,m=(e[x+w][_+u].re-o)/g*255;s.data[f]=m,s.data[f+1]=m,s.data[f+2]=m,s.data[f+3]=255}return s}function Pt(e,t=5,r,s,o=3){const a=e.data,u=e.width,w=e.height,g=[];o=o||3,s=s||t/3;const C=-1/(2*s*s);t=t||5,r=r||t/3;const x=t*2+1;for(let p=0;p<o*256;p++)g[p]=Math.exp(p*p*C);const _=[],f=1/(2*r*r*Math.PI),m=-f*Math.PI;for(let p=-t;p<=t;p++)for(let U=-t;U<=t;U++){const D=f*Math.exp((p*p+U*U)*m);_.push(D)}for(let p=0;p<u;p++)for(let U=0;U<w;U++){let D=0,j=0,G=0,E=0;const O=(U*u+p)*4,c=a[O],l=a[O+1],i=a[O+2];for(let h=-t;h<=t;h++){const M=rt(h,p,u);for(let n=-t;n<=t;n++){const v=(rt(n,U,w)*u+M)*4,b=n+t,I=h+t,T=a[v],F=a[v+1],k=a[v+2],A=_[b*x+I]*g[Math.abs(T-c)+Math.abs(F-l)+Math.abs(k-i)];D+=a[v]*A,j+=a[v+1]*A,G+=a[v+2]*A,E+=A}}E=1/E;const y=(U*u+p)*4;a[y]=~~(E*D),a[y+1]=~~(E*j),a[y+2]=~~(E*G)}return e}function rt(e,t,r){let s=t+e;return s<0?s=-s:s>=r&&(s=r+e-t),s}const Et=["src","title"],Rt={style:{display:"flex",justifyContent:"center"}},St=["src","title"],Vt=It({__name:"ImgHD",setup(e){const t=B(0),r=B(0),s=B(!1),o=B([]),a=document.createElement("canvas"),u=a.getContext("2d"),w=B([]),g=B(""),C=()=>{const c=document.createElement("a"),l=new Blob([g.value],{type:"text/plain;charset=utf-8;"});c.href=URL.createObjectURL(l),c.download="download.txt",c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},x=async c=>{const l=document.createElement("canvas");l.width=c.width,l.height=c.height;const i=l.getContext("2d");return i==null||i.putImageData(c,0,0),l.toDataURL("image/png")},_=async(c,l,i)=>{console.log("avg");const y=[...c.data];for(let n=0;n<c.data.length;n+=4){let d=c.data[n],v=c.data[n+1],b=c.data[n+2],I=1;n%(4*l)!==0&&(d+=c.data[n-4],v+=c.data[n-4+1],b+=c.data[n-4+2],I++),n>=4*l&&(d+=c.data[n-4*l],v+=c.data[n-4*l+1],b+=c.data[n-4*l+2],I++),n!==4*(l-1)&&(d+=c.data[n+4],v+=c.data[n+4+1],b+=c.data[n+4+2],I++),n<=4*l*(i-1)&&(d+=c.data[n-4*l],v+=c.data[n-4*l+1],b+=c.data[n-4*l+2],I++),y[n]=Math.floor(d/I),y[n+1]=Math.floor(v/I),y[n+2]=Math.floor(b/I)}const h=document.createElement("canvas");h.width=l,h.height=i;const M=h.getContext("2d");return M==null||M.putImageData(new ImageData(Uint8ClampedArray.from(y),l,i),0,0),console.log("avgend"),h.toDataURL("image/png")},f=async(c,l,i)=>{l=l||c.width,i=i||c.height;const y=[];for(let h=0;h<l;h++)for(let M=0;M<i;M++){const n=(h+M*l)*4,d=.299*c.data[n]+.587*c.data[n+1]+.114*c.data[n+2];y[n]=d,y[n+1]=d,y[n+2]=d,y[n+3]=c.data[n+3]}return new ImageData(Uint8ClampedArray.from(y),l,i)},m=async(c,l,i)=>{console.log("chazhi");const y=[],h=c.width,M=c.height,n=(b,I,T)=>b<0||b>=h||I<0||I>=M?0:c.data[(b+I*h)*4+T];for(let b=0;b<l;b++)for(let I=0;I<i;I++){const T=b*h/l,F=I*M/i,k=Math.floor(T),A=Math.floor(F),L=Math.ceil(T),R=Math.ceil(F),S=k-T,q=A-F;for(let V=0;V<4;V++){const ht=(b+I*l)*4+V,pt=n(L,R,V),wt=n(L,A,V),yt=n(k,R,V),gt=n(k,A,V);y[ht]=Math.min(255,Math.max(0,Math.round(S*q*pt+S*(1-q)*wt+(1-S)*q*yt+(1-S)*(1-q)*gt)))}}const d=document.createElement("canvas");d.width=l,d.height=i;const v=d.getContext("2d");return v==null||v.putImageData(new ImageData(Uint8ClampedArray.from(y),l,i),0,0),console.log("chazhiend"),d.toDataURL("image/png")},p=async(c,l,i)=>{console.log("ruihua");const y=[0,-1,0,-1,4,-1,0,-1,0],h=[...c.data];for(let d=0;d<l;d++)for(let v=0;v<i;v++)for(let b=0;b<3;b++){const I=(d+v*l)*4+b;let T=0;for(let F=0;F<3;F++)for(let k=0;k<3;k++){const A=d+F-1,L=v+k-1;if(A>=0&&A<l&&L>=0&&L<i){const R=(A+L*l)*4+b;T+=y[F*3+k]*c.data[R]}}h[I]=Math.min(Math.max(h[I]+T,0),255)}const M=document.createElement("canvas");M.width=l,M.height=i;const n=M.getContext("2d");return n==null||n.putImageData(new ImageData(Uint8ClampedArray.from(h),l,i),0,0),console.log("ruihuaend"),M.toDataURL("image/png")},U=async(c,l=3)=>{const{width:i,height:y,data:h}=c,M=new Uint8ClampedArray(h.length),n=Math.floor(l/2);for(let d=n;d<y-n;d++)for(let v=n;v<i-n;v++){const b=(d*i+v)*4,I=[];for(let F=-n;F<=n;F++)for(let k=-n;k<=n;k++){const A=((d+F)*i+(v+k))*4,L=h[A],R=h[A+1],S=h[A+2];I.push({rgb:[L,R,S],gray:.299*L+.587*R+.114*S})}I.sort((F,k)=>F.gray-k.gray);const T=I[Math.floor(I.length/2)];for(let F=0;F<4;F++)M[b+F]=F===3?h[b+3]:T.rgb[F]}return new ImageData(M,i,y)},j=(c=0)=>new Promise(l=>{setTimeout(()=>{l(!0)},c)}),G=c=>{o.value=[],w.value=[];const l=c.target.files[0];if(l&&l.type.startsWith("image/")){const i=new Image;i.onload=async()=>{const y=i.width,h=i.height;t.value=Math.max(y,400),r.value=Math.min(y,100),a.width=y,a.height=h,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u==null||u.drawImage(i,0,0,y,h),o.value.push({src:a.toDataURL("image/png"),time:0,title:"源"});const M=u==null?void 0:u.getImageData(0,0,y,h);if(g.value=a.toDataURL("image/png"),M){let n=Date.now(),d=await _(M,y,h);o.value.push({src:d,time:Date.now()-n,title:"上下左右平均"}),await j(),n=Date.now(),d=await p(M,y,h),o.value.push({src:d,time:Date.now()-n,title:"锐化"}),await j(),n=Date.now(),d=await m(M,Math.floor(y*1.5),Math.floor(h*1.5)),o.value.push({src:d,time:Date.now()-n,title:"插值"}),await j(),n=Date.now();const v=await U(M);d=await x(v),o.value.push({src:d,time:Date.now()-n,title:"中值滤波"}),d=await p(v,v.width,v.height),o.value.push({src:d,time:Date.now()-n,title:"中值滤波+锐化"}),await j(),n=Date.now();const b=await _t(M);d=await x(b),o.value.push({src:d,time:Date.now()-n,title:"频谱1"}),await j(),n=Date.now();const I=await at(M);d=await x(I),o.value.push({src:d,time:Date.now()-n,title:"高斯滤波器"}),await j(),n=Date.now();const T=await at(M,{type:"ideal"});d=await x(T),o.value.push({src:d,time:Date.now()-n,title:"ideal"}),await j(),n=Date.now();const F=await f(M);d=await x(F),o.value.push({src:d,time:Date.now()-n,title:"灰度"});const k=await U(F);d=await x(k),o.value.push({src:d,time:Date.now()-n,title:"灰度+中值滤波"}),await j(),n=Date.now();const A=await Tt(F);d=await x(A),o.value.push({src:d,time:Date.now()-n,title:"校验逆向"}),await j(),n=Date.now();const L=await Pt(M);d=await x(L),o.value.push({src:d,time:Date.now()-n,title:"双边滤波"})}},i.src=URL.createObjectURL(l)}},E=({i:c},l)=>{const i=w.value.indexOf(c);l?i===-1&&w.value.push(c):c>-1&&w.value.splice(i,1)},O=()=>{s.value=!0};return(c,l)=>(X(),Y(Z,null,[P("div",{class:"img-hd",style:bt({"--img-width":r.value+"px"})},[P("input",{type:"file",onChange:G},null,32),$(Mt,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=i=>r.value=i),style:{width:"200px",display:"inline-block"},max:t.value||100},null,8,["modelValue","max"]),$(W,{style:{marginLeft:"20px"},type:"primary",onClick:O,disabled:w.value.length!==2},{default:J(()=>[et(" 对比 ")]),_:1},8,["disabled"]),$(W,{style:{marginLeft:"20px"},type:"primary",onClick:C,disabled:!g.value},{default:J(()=>[et(" 下载 ")]),_:1},8,["disabled"]),P("div",null,[(X(!0),Y(Z,null,tt(o.value,(i,y)=>(X(),Y("div",{key:i.title,class:"img-hd-item"},[P("img",{src:i.src,title:i.title},null,8,Et),P("div",null,"耗时："+N(i.time)+"ms",1),$(vt,{label:i.title,onChange:h=>E({item:i,i:y},h)},null,8,["label","onChange"])]))),128))])],4),$(xt,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=i=>s.value=i),title:"对比",width:"100%","unmount-on-close":!0,class:Ft(c.$style["comparision-modal"]),footer:!1},{default:J(()=>[P("div",Rt,[(X(!0),Y(Z,null,tt(w.value,i=>(X(),Y("div",{key:`comparision-${i}`,class:"img-hd-item",style:{maxWidth:"calc(50% - 20px)"}},[P("img",{src:o.value[i].src,title:o.value[i].title},null,8,St),P("div",null,"耗时："+N(o.value[i].time)+"ms",1),P("div",null,N(o.value[i].title),1)]))),128))])]),_:1},8,["modelValue","class"])],64))}}),Bt={"comparision-modal":"_comparision-modal_lww03_1"},zt={$style:Bt},Qt=Ct(Vt,[["__cssModules",zt],["__scopeId","data-v-a4e77f57"]]);export{Qt as default};
