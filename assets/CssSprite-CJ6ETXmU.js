import{d as defineComponent,a as ref,o as openBlock,b as createElementBlock,e as createBaseVNode,C as withDirectives,H as vModelText,f as createVNode,w as withCtx,u as unref,_ as _export_sfc}from"./index-C8_KvqLc.js";import{M as MjTabs}from"./index-D5Ao2_O2.js";import{_ as _sfc_main$1}from"./MjPre.vue_vue_type_style_index_0_lang-C0WN2G5J.js";import"./index-C1s-hTSf.js";import"./MjMessage-B6PxiNxc.js";const _hoisted_1={class:"css-sprite"},_sfc_main=defineComponent({__name:"CssSprite",setup(__props){const MjTabPanel=MjTabs.Panel,uploadRef=ref(),downloadRef=ref(),imgsRef=ref(),canvasBox=ref(),offset=ref(0),splitNum=ref(9),temp=ref(localStorage.getItem("cssSpriteTemp")||`.<%=name%> {
  background: url(./css_sprites<%=num%>.png) <%=size%>px -<%=x%>px -<%=y%>px no-repeat;
  width: <%=w%>px;
  height: <%=h%>px;
}`),cssContent=ref(""),tempChange=()=>{localStorage.setItem("cssSpriteTemp",temp.value)},imgs=ref([]),num=ref(0),generateCssSpriteChild=(list,index)=>{const canvas=document.createElement("canvas");canvasBox.value.appendChild(canvas);const ctx=canvas.getContext("2d"),hArr=[];let cw=offset.value;list.forEach(t=>{hArr.push(t.height),cw+=t.width+offset.value});const ch=Math.max(...hArr)+offset.value*2;canvas.width=cw,canvas.height=ch;let left=offset.value;list.forEach(el=>{ctx.drawImage(el.el,left,offset.value);const ns=el.name.split(".");offset.value,el.width,el.height,ns.slice(0,ns.length-1).join("_"),cssContent.value+=temp.value.replace(/<%=([^%]+)%>/g,($0,$1)=>eval($1.replace(/(x|y|w|h|name|num|size)/g,"map.$1")))+`
`,left+=el.width+offset.value});const a=document.createElement("a");a.innerText=`css_sprite${index}.png`,a.href=canvas.toDataURL(),a.download=`css_sprite${index}.png`,downloadRef.value.appendChild(a)},generateCssSprite=()=>{canvasBox.value.innerHTML="",downloadRef.value.innerHTML="";let t=1;for(let e=0;e<imgs.value.length;e+=splitNum.value)generateCssSpriteChild(imgs.value.slice(e,Math.min(e+splitNum.value,imgs.value.length)),t++)},fileChange=()=>{const t=Array.from(uploadRef.value.files||[]),e=imgs.value.length;t.forEach((s,o)=>{const l=new FileReader;l.readAsDataURL(s),l.onload=()=>{if(l.result){const n=document.createElement("img");imgs.value.push({src:l.result.toString(),el:n,name:s.name,width:0,height:0,size:s.size}),n.onload=()=>{imgs.value[e+o].width=n.width,imgs.value[e+o].height=n.height,imgsRef.value.appendChild(n),num.value++,num.value===t.length&&generateCssSprite()},n.src=l.result.toString()}}})};return(t,e)=>(openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("input",{type:"file",multiple:"",onChange:fileChange,ref_key:"uploadRef",ref:uploadRef},null,544),withDirectives(createBaseVNode("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=s=>splitNum.value=s)},null,512),[[vModelText,splitNum.value]]),createBaseVNode("div",{class:"preview-imgs",ref_key:"imgsRef",ref:imgsRef},null,512),createVNode(unref(MjTabs),{"default-active-key":"img"},{default:withCtx(()=>[createVNode(unref(MjTabPanel),{title:"图片",key:"img"},{default:withCtx(()=>[createBaseVNode("div",{class:"canvas-box",ref_key:"canvasBox",ref:canvasBox},null,512)]),_:1}),createVNode(unref(MjTabPanel),{title:"css",key:"css"},{default:withCtx(()=>[createVNode(_sfc_main$1,{value:cssContent.value,lang:"css"},null,8,["value"])]),_:1}),createVNode(unref(MjTabPanel),{title:"css模板",key:"temp",style:{"padding-top":"20px"}},{default:withCtx(()=>[withDirectives(createBaseVNode("textarea",{cols:"100",rows:"6","onUpdate:modelValue":e[1]||(e[1]=s=>temp.value=s),onChange:tempChange},null,544),[[vModelText,temp.value]])]),_:1}),createVNode(unref(MjTabPanel),{title:"下载",key:"download"},{default:withCtx(()=>[createBaseVNode("div",{ref_key:"downloadRef",ref:downloadRef,class:"downloads"},null,512)]),_:1})]),_:1})]))}}),CssSprite=_export_sfc(_sfc_main,[["__scopeId","data-v-8f2902c7"]]);export{CssSprite as default};
