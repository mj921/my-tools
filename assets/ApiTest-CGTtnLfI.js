import{M as c}from"./MjButton-BmN55pLQ.js";import{M as $}from"./MjSwitch-cGSJiosA.js";import{M}from"./index-BA0Druey.js";import{m as V}from"./MjMessage-B6PxiNxc.js";import{M as D}from"./MjModal-D8GbfQV7.js";import{M as F}from"./MjSelect-CB5zIzi7.js";import{M as O}from"./MjTable-D9Fewee_.js";import{M as y}from"./MjTextarea-yOKFGuNi.js";import{r as J}from"./index-D0LXxPA_.js";import{B as S}from"./BinaryWriter-4Snmgu5s.js";import{g as b}from"./index-C1s-hTSf.js";import{d as q,a as i,r as G,x as H,o as K,b as P,e as x,f as o,w as s,t as p,u as v,_ as Q}from"./index-C8_KvqLc.js";import"./LoadingIcon.vue_vue_type_script_setup_true_lang-Cjl4ccjb.js";import"./CloseIcon.vue_vue_type_script_setup_true_lang-BO1-knco.js";import"./MjCheckbox-CRx5YV5s.js";const X={class:"api-test"},Y={class:"api-test-btns"},Z=q({__name:"ApiTest",setup(ee){const f=M.FormItem,d=i(!1),C=i(),m=i([]),h=i("add"),n=i({}),w=G({type:"checkbox",width:40}),j=["get","post","put","delete","options","patch"],U=[{title:"url",name:"url",minWidth:80},{title:"method",name:"method",width:80},{title:"headers",name:"headers",minWidth:85},{title:"params",name:"params",minWidth:80},{title:"存本地",name:"saveLocal",slotName:"saveLocal",width:80},{title:"操作",name:"operation",slotName:"operation",width:205}],l=i({url:"",method:"get",headers:"",params:"",uuid:"",saveLocal:!1}),N=()=>{if(!l.value.url){V.error("请输入url");return}if(!l.value.method){V.error("请输入method");return}if(!l.value.headers){V.error("请输入headers");return}if(!l.value.params){V.error("请输入params");return}if(l.value.uuid)n.value[l.value.uuid]={...l.value},l.value.saveLocal&&g();else{const e={...l.value,uuid:b(),saveLocal:!1};n.value[e.uuid]=e,m.value.push(e.uuid)}};H([d],()=>{d.value===!1&&(l.value={url:"",method:"get",headers:"",params:"",uuid:"",saveLocal:!1})});const A=()=>{h.value="add",d.value=!0},B=e=>{h.value="edit",d.value=!0,l.value={...e}},R=e=>{h.value="add",d.value=!0,l.value={...e,uuid:"",saveLocal:!1}},L=e=>{J({url:e.url,method:e.method,headers:JSON.parse(e.headers),data:JSON.parse(e.params)})},T=()=>{const e=new S("Read",1),t=localStorage.getItem("apitest");if(t){e.setRawData(t);const a=e.readArray(r=>r.readString());return e.readArray(r=>{const u={};return a.forEach(k=>{u[k]=r.readString()}),u})}return[]};m.value=T().map(e=>{const t=b();return n.value[t]={...e,saveLocal:!0,uuid:t},t});const g=()=>{const e=new S("Write",1e5),t=["url","method","headers","params"];e.writeArray(t,(r,u)=>{u.writeString(r)});const a=[];m.value.forEach(r=>{const u=n.value[r];u.saveLocal&&a.push(u)}),e.writeArray(a,(r,u)=>{t.forEach(k=>{u.writeString(r[k])})}),localStorage.setItem("apitest",e.getRawDataStr())},E=()=>{g()},I=e=>{delete n.value[e.uuid],m.value=m.value.filter(t=>t!==e.uuid),e.saveLocal&&g()},_=i([]),W=e=>{_.value=e},z=()=>{_.value.forEach(e=>L(n.value[e]))};return(e,t)=>(K(),P("div",X,[x("div",null,[x("div",Y,[o(c,{type:"primary",onClick:A},{default:s(()=>[p("添加")]),_:1}),o(c,{type:"outline",disabled:_.value.length===0,onClick:z},{default:s(()=>[p("批量运行")]),_:1},8,["disabled"])]),o(O,{columns:U,data:m.value.map(a=>n.value[a]),"row-selection":w,"primary-key":"uuid",onSelectionChange:W},{saveLocal:s(({row:a})=>[o($,{modelValue:a.saveLocal,"onUpdate:modelValue":r=>a.saveLocal=r,onChange:E,"checked-text":"是","unchecked-text":"否"},null,8,["modelValue","onUpdate:modelValue"])]),operation:s(({row:a})=>[o(c,{type:"text",status:"normal",size:"small",onClick:r=>B(a)},{default:s(()=>[p("编辑")]),_:2},1032,["onClick"]),o(c,{type:"text",status:"normal",size:"small",onClick:r=>R(a)},{default:s(()=>[p("复制")]),_:2},1032,["onClick"]),o(c,{type:"text",status:"normal",size:"small",onClick:r=>L(a)},{default:s(()=>[p("运行")]),_:2},1032,["onClick"]),o(c,{type:"text",status:"danger",size:"small",onClick:r=>I(a)},{default:s(()=>[p("删除")]),_:2},1032,["onClick"])]),_:1},8,["data","row-selection"]),o(D,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=a=>d.value=a),title:h.value==="add"?"添加":"编辑","title-align":"start",onOk:N},{default:s(()=>[o(v(M),{ref_key:"formRef",ref:C,model:l.value},{default:s(()=>[o(v(f),{label:"url",name:"url"},{default:s(()=>[o(y,{modelValue:l.value.url,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.url=a)},null,8,["modelValue"])]),_:1}),o(v(f),{label:"method",name:"method"},{default:s(()=>[o(F,{modelValue:l.value.method,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.method=a),options:j},null,8,["modelValue"])]),_:1}),o(v(f),{label:"headers",name:"headers"},{default:s(()=>[o(y,{modelValue:l.value.headers,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.headers=a),rows:"5"},null,8,["modelValue"])]),_:1}),o(v(f),{label:"params",name:"params"},{default:s(()=>[o(y,{modelValue:l.value.params,"onUpdate:modelValue":t[3]||(t[3]=a=>l.value.params=a),rows:"5"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])]))}}),he=Q(Z,[["__scopeId","data-v-bb7e704a"]]);export{he as default};
