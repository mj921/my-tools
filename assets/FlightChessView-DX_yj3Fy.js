var ie=Object.defineProperty;var oe=(n,i,u)=>i in n?ie(n,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[i]=u;var v=(n,i,u)=>oe(n,typeof i!="symbol"?i+"":i,u);import{M as re}from"./MjButton-BmN55pLQ.js";import{d as ne,a as p,j as ce,o as he,b as ue,e as Y,n as Q,f as fe,w as ve,u as U,v as pe,t as de,_ as we}from"./index-C8_KvqLc.js";import"./LoadingIcon.vue_vue_type_script_setup_true_lang-Cjl4ccjb.js";var T=(n=>(n[n.Dice=0]="Dice",n[n.SelectChess=1]="SelectChess",n[n.Move=2]="Move",n))(T||{});class P{}v(P,"dpr",3);var C=(n=>(n[n.Ready=1]="Ready",n[n.Move=2]="Move",n[n.Finish=3]="Finish",n[n.Merge=4]="Merge",n))(C||{});class q{constructor(i,u,m){v(this,"color");v(this,"level",1);v(this,"status");v(this,"homePoint");v(this,"position");v(this,"size");v(this,"canvas");v(this,"ctx");this.homePoint=u,this.color=i,this.status=1,this.position=-1,this.size=m,this.canvas=new OffscreenCanvas(m,m),this.ctx=this.canvas.getContext("2d"),this.draw()}merge(i){this.level+=i.level,i.level=0,i.status=4,this.draw()}draw(){if(!this.ctx)return;const i=this.ctx;i.clearRect(0,0,this.size,this.size),i.fillStyle=this.color,i.strokeStyle="black",i.lineWidth=P.dpr,i.beginPath(),i.ellipse(.5*this.size,(.5+.05-.1*this.level)*this.size,.45*this.size,.35*this.size,0,0,Math.PI*2),i.lineTo((.5+.45)*this.size,(.5+.15-.1*this.level)*this.size),i.ellipse(.5*this.size,(.5+.15-.1*this.level)*this.size,.45*this.size,.35*this.size,0,0,Math.PI),i.lineTo((.5-.45)*this.size,(.5+.05-.1*this.level)*this.size),i.fill(),i.stroke()}}class V{constructor(i,u,m,f,d){v(this,"color");v(this,"chessGroups",[]);v(this,"birthPoint");v(this,"plantPoint");v(this,"size");v(this,"pathCell");this.size=f,this.color=i,this.plantPoint=m,this.pathCell=d,this.chessGroups=[new q(i,0,f),new q(i,1,f),new q(i,2,f),new q(i,3,f)],this.birthPoint=u}drawChess(i){this.chessGroups.forEach((u,m)=>{switch(u.status){case C.Ready:case C.Finish:i.drawImage(u.canvas,(this.plantPoint.x-.5+(m%2===1?1:-1))*this.size,(this.plantPoint.y-.5+(Math.floor(m/2)===1?1:-1))*this.size);break;case C.Move:if(u.position===-1)i.drawImage(u.canvas,this.birthPoint.x*this.size,this.birthPoint.y*this.size);else{const f=this.pathCell[u.position];let d=f.x,g=f.y;switch(f.type){case"rect":f.rectType==="horizontal"?d+=.5:f.rectType==="vertical"&&(g+=.5);break;case"triangle":switch(f.triangleType){case"topLeft":d+=.05,g+=.05;break;case"topRight":d+=.95,g+=.05;break;case"bottomLeft":d+=.05,g+=.95;break;case"bottomRight":d+=.95,g+=.95;break}break}i.drawImage(u.canvas,d*this.size,g*this.size)}break;case C.Merge:break}})}}const ge={class:"flight-chess-dice"},ye={class:"flight-chess-dice-num"},be=ne({__name:"FlightChessView",setup(n){const i=p(T.Dice),u=p(0),m=p(),f=p(),d=p(),g=p(),L=p(),E=p(),h=p(Math.floor(Math.min(window.innerWidth,window.innerHeight)/17)*P.dpr),F=p([]),M=p([]),S=p(!1),R=p(6),H=p(),Z=()=>{i.value=T.SelectChess},A=(t=!1)=>{i.value=T.Dice,t||(u.value=(u.value+1)%M.value.length)},G=t=>{if(!(R.value!==6&&t.status!==C.Move))if(t.status===C.Ready)t.status=C.Move,t.position=-1,B(),A(!0);else{i.value=T.Move;let l=1;const e=a=>{t.position+=l,t.position===58&&(l=-1),B(),a>1?setTimeout(()=>e(a-1),500):A(R.value===6)};e(R.value),B()}},$=(t=180)=>{H.value=Math.floor(Math.random()*6)+1,!S.value||t===0?(S.value=!1,R.value=Math.floor(Math.random()*2)+5,R.value===6||M.value[u.value].chessGroups.find(l=>l.status===C.Move)?Z():A()):requestAnimationFrame(()=>$(t-1))},ee=()=>{S.value||(S.value=!0,$())},O=(t,l,e,a,o)=>{const{fillColor:r,ctx:s=g.value}=o||{};s&&(r&&(s.fillStyle=r),B(),s.fillRect(t*h.value,l*h.value,e*h.value,a*h.value))},N=(t,l,e,a,o)=>{const{fillColor:r,wSegments:s=1,hSegments:y=1,wSpace:b=0,hSpace:_=0,marginBlock:D=0,marginInline:k=0,ctx:x=g.value}=o||{};if(!x)return;r&&(x.fillStyle=r);const J=(e-(s-1)*b-k*2)/s,K=(a-(y-1)*_-D*2)/y;for(let W=0;W<s;W++)for(let X=0;X<y;X++)O(k+t+(J+b)*W,D+l+(K+_)*X,J,K,{fillColor:r})},z=(t,l)=>{const{fillColor:e,ctx:a=g.value}=l||{};if(!a||t.length<2)return;e&&(a.fillStyle=e);let o=[];if(typeof t[0]=="number")for(let r=0;r<t.length;r+=2)o.push({x:t[r],y:t[r+1]});else o=t;a.beginPath(),a.moveTo(o[0].x*h.value,o[0].y*h.value),o.slice(1).forEach(({x:r,y:s})=>{a.lineTo(r*h.value,s*h.value)}),a.fill()},w=(t,l,e,a)=>{const{fillColor:o,ctx:r=g.value}=a||{};r&&(o&&(r.fillStyle=o),r.beginPath(),r.arc(t*h.value,l*h.value,e*h.value,0,Math.PI*2),r.fill())},I=p([]),c=["green","blue","red","gold"],j=["bottomRight","bottomLeft","topLeft","topRight"],te=()=>{const t=[];let l="beforeFirst",e=0,a=0;for(let s=0;s<52;s++)switch(l){case"beforeFirst":t.push({color:c[s%4],x:e%2===0?e===0?0:15:(e===1?9:7)+(e===1?1:-1)*a,y:e%2===1?e===1?0:15:(e===0?7:9)+(e===2?1:-1)*a,type:"rect",rectType:e%2===0?"horizontal":"vertical"}),a++,a===2&&(l="first",a=0);break;case"first":t.push({color:c[s%4],x:[0,11,15,4][e],y:[4,0,11,15][e],type:"triangle",triangleType:j[e]}),l="afterFirst";break;case"afterFirst":t.push({color:c[s%4],x:e%2===1?e===1?11:4:(e===2?14:2)+(e===2?-1:1)*a,y:e%2===0?e===0?4:11:(e===1?2:14)+(e===1?1:-1)*a,type:"rect",rectType:e%2===1?"horizontal":"vertical"}),a++,a===2&&(l="jumpEnd",a=0);break;case"jumpEnd":t.push({color:c[s%4],x:[4,11,11,4][e],y:[4,4,11,11][e],type:"triangle",triangleType:j[(e+1)%4]}),l="jumpStart";break;case"jumpStart":t.push({color:c[s%4],x:[4,11,11,4][e],y:[4,4,11,11][e],type:"triangle",triangleType:j[(e+3)%4]}),l="beforeEnd";break;case"beforeEnd":t.push({color:c[s%4],x:e%2===0?e===0?4:11:(e===1?13:3)+(e===1?1:-1)*a,y:e%2===1?e===1?4:11:(e===2?13:3)+(e===2?1:-1)*a,type:"rect",rectType:e%2===0?"horizontal":"vertical"}),a++,a===2&&(l="end",a=0);break;case"end":t.push({color:c[s%4],x:[4,15,11,0][e],y:[0,4,15,11][e],type:"triangle",triangleType:j[e]}),l="afterEnd";break;case"afterEnd":t.push({color:c[s%4],x:e%2===1?e===1?15:0:(e===0?6:10)+(e===0?1:-1)*a,y:e%2===0?e===0?0:15:(e===1?6:10)+(e===1?1:-1)*a,type:"rect",rectType:e%2===1?"horizontal":"vertical"}),a++,a===2&&(l="final",a=0);break;case"final":t.push({color:c[s%4],x:e%2===1?e===1?15:0:8,y:e%2===0?e===0?0:15:8,type:"rect",rectType:e%2===1?"horizontal":"vertical"}),e++,a=0,l="beforeFirst";break}const o=[[],[],[],[]];for(let s=0;s<13;s++)o[3].push((s+2)%52),o[0].push((s+15)%52),o[1].push((s+28)%52),o[2].push((s+41)%52);const r=[[],[],[],[]];for(let s=0;s<5;s++)r[0].push({color:c[0],x:8,y:s+2,type:"rect",rectType:"square"}),r[1].push({color:c[1],x:14-s,y:8,type:"rect",rectType:"square"}),r[2].push({color:c[2],x:8,y:14-s,type:"rect",rectType:"square"}),r[3].push({color:c[3],x:s+2,y:8,type:"rect",rectType:"square"}),o[0].push(52+s),o[1].push(57+s),o[2].push(62+s),o[3].push(67+s);t.push(...r[0],...r[1],...r[2],...r[3]),I.value=t,F.value=o},le=({x:t,y:l,rectType:e,color:a})=>{O(t,l,e==="horizontal"?2:1,e==="vertical"?2:1,{fillColor:a}),w(t+(e==="horizontal"?1:.5),l+(e==="vertical"?1:.5),.35,{fillColor:"white"})},ae=({x:t,y:l,triangleType:e,color:a})=>{switch(e){case"topLeft":z([t,l,t+2,l,t,l+2],{fillColor:a}),w(t+.55,l+.55,.35,{fillColor:"white"});break;case"topRight":z([t,l,t+2,l,t+2,l+2],{fillColor:a}),w(t+1.45,l+.55,.35,{fillColor:"white"});break;case"bottomLeft":z([t,l,t+2,l+2,t,l+2],{fillColor:a}),w(t+.55,l+1.45,.35,{fillColor:"white"});break;case"bottomRight":z([t+2,l,t+2,l+2,t,l+2],{fillColor:a}),w(t+1.45,l+1.45,.35,{fillColor:"white"});break}},se=(t,l,e)=>{O(t,l,4,4,{fillColor:e}),w(t+1,l+1,.45,{fillColor:"white"}),w(t+3,l+1,.45,{fillColor:"white"}),w(t+1,l+3,.45,{fillColor:"white"}),w(t+3,l+3,.45,{fillColor:"white"})},B=()=>{!f.value||!E.value||(E.value.clearRect(0,0,h.value*17,h.value*17),M.value.forEach(t=>{t.drawChess(E.value)}),f.value.clearRect(0,0,h.value*17,h.value*17),f.value.drawImage(d.value,0,0),f.value.drawImage(L.value,0,0))};return ce(()=>{const t=document.createElement("canvas");t.width=h.value*17,t.height=h.value*17,t.style.width=t.width/P.dpr+"px",t.style.height=t.height/P.dpr+"px",d.value=new OffscreenCanvas(t.width,t.height),g.value=d.value.getContext("2d"),L.value=new OffscreenCanvas(t.width,t.height),E.value=L.value.getContext("2d"),m.value.appendChild(t),f.value=t.getContext("2d"),z([7,7,10,7,8.5,8.5],{fillColor:c[0]}),w(8.5,7.5,.35,{fillColor:"white"}),z([10,7,10,10,8.5,8.5],{fillColor:c[1]}),w(9.5,8.5,.35,{fillColor:"white"}),z([10,10,7,10,8.5,8.5],{fillColor:c[2]}),w(8.5,9.5,.35,{fillColor:"white"}),z([7,7,8.5,8.5,7,10],{fillColor:c[3]}),w(7.5,8.5,.35,{fillColor:"white"}),te(),I.value.forEach(l=>{switch(l.type){case"rect":le(l);break;case"triangle":ae(l);break}}),N(6,12.45,5,.1,{fillColor:c[0],wSegments:10,hSegments:1,wSpace:.1,marginInline:.1}),N(4.45,6,.1,5,{fillColor:c[1],wSegments:1,hSegments:10,hSpace:.1,marginBlock:.1}),N(6,4.45,5,.1,{fillColor:c[2],wSegments:10,hSegments:1,wSpace:.1,marginInline:.1}),N(12.45,6,.1,5,{fillColor:c[3],wSegments:1,hSegments:10,hSpace:.1,marginBlock:.1}),M.value=[new V(c[0],{x:12,y:0},{x:15,y:2},h.value,F.value[0].map(l=>I.value[l])),new V(c[1],{x:16,y:12},{x:15,y:15},h.value,F.value[1].map(l=>I.value[l])),new V(c[2],{x:4,y:16},{x:2,y:15},h.value,F.value[2].map(l=>I.value[l])),new V(c[3],{x:0,y:4},{x:2,y:2},h.value,F.value[3].map(l=>I.value[l]))],M.value.forEach(l=>{const{plantPoint:e,color:a}=l;se(e.x-2,e.y-2,a),l.drawChess(E.value)}),f.value.drawImage(d.value,0,0),f.value.drawImage(L.value,0,0),t.addEventListener("click",l=>{if(i.value!==T.SelectChess)return;const e=Math.floor(l.offsetX*P.dpr/h.value),a=Math.floor(l.offsetY*P.dpr/h.value),o=M.value[u.value];let r;if(e>=o.plantPoint.x-2&&e<o.plantPoint.x+2&&a>=o.plantPoint.y-2&&a<o.plantPoint.y+2)for(let s=0;s<o.chessGroups.length;s++){const y=o.chessGroups[s];if(y.status===C.Ready){const b=o.plantPoint.x-2+(s%2===1?2:0),_=o.plantPoint.y-2+(Math.floor(s/2)===1?2:0);if(e>=b&&e<b+2&&a>=_&&a<_+2){r=y;break}}}else for(let s=0;s<o.chessGroups.length;s++){const y=o.chessGroups[s];if(y.status===C.Move)if(y.position===-1){if(e===o.birthPoint.x&&a===o.birthPoint.y){r=y;break}}else{const b=o.pathCell[y.position];let _=1,D=1,k=b.x,x=b.y;switch(b.type){case"rect":b.rectType==="horizontal"?k+=1:b.rectType==="vertical"&&(x+=1);break;case"triangle":switch(b.triangleType){case"topLeft":k+=.05,x+=.05;break;case"topRight":k+=.95,x+=.05;break;case"bottomLeft":k+=.05,x+=.95;break;case"bottomRight":k+=.95,x+=.95;break}break}if(e>=k&&e<k+_&&a>=x&&a<x+D){r=y;break}}}r&&G(r)})}),(t,l)=>{var e;return he(),ue("div",{ref_key:"container",ref:m,class:"flight-chess",style:Q({"--flight-chess-size":`${h.value/U(P).dpr}px`})},[Y("div",ge,[Y("div",{class:"flight-chess-current-player",style:Q({backgroundColor:((e=M.value[u.value])==null?void 0:e.color)||c[0]})},null,4),fe(re,{type:"primary",disabled:i.value!==U(T).Dice||S.value,onClick:ee},{default:ve(()=>[de("🎲 投骰子")]),_:1},8,["disabled"])]),Y("div",ye,pe(S.value?H.value:R.value),1)],4)}}}),ze=we(be,[["__scopeId","data-v-9ba3be79"]]);export{ze as default};
