import{d as A,o as D,b as M,l as C,F as E,q as F,t as N,v as U,E as O,w as P,f as B,R as Q,M as V,c as I}from"./index-C8_KvqLc.js";import{g as c}from"./index-C1s-hTSf.js";const Z=A({name:"MjMdDom",__name:"MjMdDom",props:{doms:{}},setup(H){return(q,S)=>{const w=F("mj-md-dom",!0);return D(!0),M(E,null,C(q.doms,u=>(D(),M(E,{key:u.id},[u.type==="text"?(D(),M(E,{key:0},[N(U(u.value),1)],64)):(D(),O(V(u.type),Q({key:1,ref_for:!0},u.attr,{class:u.className}),{default:P(()=>[B(w,{doms:u.children},null,8,["doms"])]),_:2},1040,["class"]))],64))),128)}}}),z=["data-theme"],K=A({__name:"MjMd",props:{content:{},theme:{default:"light"},disabledTypes:{default:()=>[]}},setup(H){const q=H,S=(u,R=0)=>{const s={},m=[{currentLine:u,level:R,pid:""}],f=(d,t,h)=>{if(h){const e=c();s[e]={pid:d,id:e,level:t,type:"text",value:h,children:[]}}},y=(d,t,h)=>{h.length>0&&m.push({currentLine:h,level:t,pid:d})},_=[{testReg:/^[^*_~<]*`.+`/,matchReg:/^([^*_~<]*)`(.+)`/,type:"code",matchHandle:(d,{level:t,currentLine:h,pid:e})=>{const[a="",p="",n]=d||[];if(y(e,t,p),p.length>0)y(e,t,"`"+n+"`");else if(a&&n){const l=c();s[l]={pid:e,id:l,level:t,type:"code",children:[]},m.push({currentLine:n,level:t+1,pid:l})}y(e,t,h.replace(a,""))}},{testReg:/^[^*_`~<]*\*\*\**[^*]*\**\*\*/,matchReg:/^([^*_`~<]*?)\*\*(\**[^*]*\**)\*\*/,type:"strong"},{testReg:/^[^*_`~<]*___*[^_]*_*__/,matchReg:/^([^*_`~<]*?)__(_*[^*]*_*)__/,type:"strong"},{testReg:/^[^*_`~<]*\*\**[^_]*\**\*/,matchReg:/^([^*_`~<]*?)\*(\**[^_]*\**)\*/,type:"em"},{testReg:/^[^*_`~<]*__*[^_]*_*_/,matchReg:/^([^*_`~<]*?)_(_*[^_]*_*)_/,type:"em"},{testReg:/^[^*_`~<]*~~~*[^~]*~*~~/,matchReg:/^([^*_`~<]*?)~~(~*[^~]*~*)~~/,type:"del"},{testReg:/^[^*_`~<]*!\[[^\]]+\]\([^)]+?(?:\s+["'][^"']+["'][^)]*)?\)/,matchReg:/^([^*_`~<]*?)!\[([^\]]+)\]\(([^)]+?)(?:\s+["']([^"']+)["'][^)]*)?\)/,type:"img",matchHandle:(d,{level:t,currentLine:h,pid:e})=>{const[a="",p="",n,l,i]=d||[];if(f(e,t,p),a&&n){const o=c();s[o]={pid:e,id:o,level:t,type:"img",attr:{src:l,title:i||""},children:[]},m.push({currentLine:n,level:t+1,pid:o})}y(e,t,h.replace(a,""))}},{testReg:/^[^*_`~<]*\[[^\]]+\]\([^)]+?(?:\s+["'][^"']+["'][^)]*)?\)/,matchReg:/^([^*_`~<]*?)\[([^\]]+)\]\(([^)]+?)(?:\s+["']([^"']+)["'][^)]*)?\)/,type:"a",matchHandle:(d,{level:t,currentLine:h,pid:e})=>{const[a="",p="",n,l,i]=d||[];if(f(e,t,p),a&&n){const o=c();s[o]={pid:e,id:o,level:t,type:"a",attr:{href:l,title:i||""},children:[]},m.push({currentLine:n,level:t+1,pid:o})}y(e,t,h.replace(a,""))}},{testReg:/^[^*_`~<]*<[^>]*>/,matchReg:/^([^*_`~<]*?)<([^>]*)>/,type:"a",matchHandle:(d,{level:t,currentLine:h,pid:e})=>{const[a="",p="",n]=d||[];if(f(e,t,p),a&&n){const l=c();s[l]={pid:e,id:l,level:t,type:"a",attr:{href:n},children:[]};const i=c();s[i]={pid:l,id:i,level:t+1,type:"text",value:n,children:[]}}y(e,t,h.replace(a,""))}}];for(;m.length>0;){const d=m.shift(),{currentLine:t,level:h,pid:e}=d;let a=!0;for(let p=0;p<_.length&&a;p++){const{testReg:n,matchReg:l,type:i,matchHandle:o}=_[p];if(!q.disabledTypes.includes(i)&&n.test(t)){if(typeof o=="function")o(t.match(l),d);else{const[v="",$="",k]=t.match(l)||[];if(f(e,h,$),v&&k){const x=c();s[x]={pid:e,id:x,level:h,type:i,children:[]},m.push({currentLine:k,level:h+1,pid:x})}y(e,h,t.replace(v,""))}a=!1}}if(a){const p=c();s[p]={pid:e,id:p,level:h,type:"text",value:t,children:[]}}}const r=[];return Object.keys(s).forEach(d=>{s[d].pid?s[s[d].pid].children.push(s[d]):r.push(s[d])}),r},w=I(()=>{const u=q.content.split(`
`);let R=[],s=R,m=[],f=[];const y=(e,a,p,n,l,i)=>{var k,x;const o=(((k=n.match(/^\s*/))==null?void 0:k[0])||"").length;let v=n.replace(p,""),$=[];if(/^\[[\sx]\]\s/.test(v)&&($.push({type:"input",children:[],attr:{type:"checkbox",disabled:!0,checked:/^\[x\]\s/.test(v)},pid:"",id:c(),level:l+2}),v=" "+v.replace(/^\[[\sx]\]\s+/,"")),e.length===0){const b={index:s.length,len:o,list:[],children:[],level:l+1,regType:i};e.push(b);const g={type:a,children:[{type:"li",children:$.concat(S(v,l+2)),pid:"",id:c(),level:l+1}],pid:"",id:c(),level:l};s.push(g),b.list=g.children,b.children=g.children[0].children}else{const b=e.findIndex(g=>g.len===o);if(b===-1){const g=e[e.length-1],j=g.list,L={index:j.length,len:o,list:j,children:[],level:g.level+1};e.push(L);const T={type:a,children:[{type:"li",children:$.concat(S(v,g.level+2)),pid:"",id:c(),level:g.level+1}],pid:"",id:c(),level:g.level};j.push(T),L.list=T.children,L.children=T.children[0].children}else{e=e.slice(0,b+1);const g=e[b],j=g.list,L={type:"li",children:$.concat(S(v,g.level+2)),pid:"",id:c(),level:g.level+1};j.push(L),g.children=(x=L.children[0])==null?void 0:x.children}}};let _=0,r=0,d=0,t="",h=[];return u.forEach((e,a)=>{var p;if(/^\s*>/.test(e)){let[n="",l=""]=e.match(/^\s*(>(?:\s*>)*)/)||[],i=l.replace(/\s/g,"").length;for(/^\s*>(\s*>)*\s*$/.test(e)&&i>_&&(n=(e.match(/^(\s*>(?:\s*>)*?)\s*>\s*$/)||[])[1]||"",i--),_===0&&(R=s,s=[],R.push({type:"blockquote",children:s,pid:"",id:c(),level:r}),r++,_++);i>_;){const o={type:"blockquote",children:[],pid:"",id:c(),level:r};s.push(o),s=o.children,r++,_++}e=e.replace(n,"")}else _>0&&e.replace(/\s/g,"").length>0&&(_=0,s=R,r--);if(/^([*-_])\1{2,}$/.test(e))m=[],f=[],t="",s.push({pid:"",id:c(),level:r,type:"hr",children:[]});else if(t===""&&a<u.length-1&&/^\s*\|([^|]*\|)+\s*$/.test(e)&&/^\s*\|(\s*:?-+:?\s*?\|)+\s*$/.test(u[a+1])){m=[],f=[],t="thead";const n=e.replace(/(^\s*\||\|\s*$)/g,"").split("|");h=u[a+1].replace(/(^\s*\||\|\s*$)/g,"").split("|").map(l=>{const i=l.replace(/(^\s*|\s*$)/g,"");if(i[0]===":"&&i[i.length-1]===":")return"text-align: center";if(i[i.length-1]===":")return"text-align: right"}),s.push({type:"table",pid:"",value:"",id:c(),children:[{type:"thead",pid:"",value:"",id:c(),children:[{type:"tr",pid:"",value:"",id:c(),children:n.map((l,i)=>({type:"th",pid:"",value:"",id:c(),children:S(l,r+3),level:r+3,attr:{style:h[i]}})),level:r+2}],level:r+1}],level:r})}else if(t==="thead")t="tbodyFirst";else if(t.includes("tbody")&&/^\s*\|([^|]*\|)+\s*$/.test(e)){const n=e.replace(/(^\s*\||\|\s*$)/g,"").split("|"),l={type:"tr",pid:"",value:"",id:c(),children:n.map((i,o)=>({type:"td",pid:"",value:"",id:c(),children:S(i,r+3),level:r+3,attr:{style:h[o]}})),level:r+2};t==="tbodyFirst"?(t="tbody",s[s.length-1].children.push({type:"tbody",pid:"",value:"",id:c(),children:[l],level:r+1})):s[s.length-1].children[1].children.push(l)}else if(d===0&&/^\s*`{3,}[^`]*$/.test(e)){t="";const[,n,l]=e.match(/^\s*(`{3,})\s*(.*)\s*$/)||[];d=n.length,s.push({type:"pre",children:[{type:"code",children:[{type:"text",pid:"",value:"",id:c(),children:[],level:r+2}],pid:"",value:"",id:c(),attr:{class:`lang-${l||""}`},level:r+1}],pid:"",value:"",id:c(),level:r})}else if(d>0)t="",new RegExp(`^\\s*${new Array(d).fill("`").join("")}\\s*$`).test(e)?d=0:s[s.length-1].children[0].children[0].value+=e+`
`;else if(/^\s*#{1,6}\s/.test(e))m=[],f=[],t="",s.push({type:`h${(((p=e.match(/^\s*(#{1,6})\s/))==null?void 0:p[1])||"").length}`,value:e.replace(/^(#{1,6})\s/,""),children:[{type:"text",value:e.replace(/^(#{1,6})\s/,""),children:[],pid:"",id:c(),level:r+1}],pid:"",id:c(),level:r});else if(/^\s*[*+-]\s/.test(e)){f=[],t="";const n=e.replace(/^\s/g,"")[0];m.length>0&&m[0].regType!==n&&(m=[]),y(m,"ul",/^\s*[*+-]\s+/,e,r,n)}else/^\s*\d+\.\s/.test(e)?(m=[],t="",y(f,"ol",/^\s*\d+\.\s+/,e,r)):e.replace(/\s/g,"")&&(m=[],f=[],t="",s.length>0&&s[s.length-1].type==="p"&&!/^\s*$/g.test(u[a-1])?s[s.length-1].children=s[s.length-1].children.concat([{type:"br",pid:"",id:c(),level:r+1,children:[]},...S(e,r+1)]):s.push({type:"p",value:e,children:S(e,r+1),pid:"",id:c(),level:r}))}),_>0&&(_=0,s=R,r--),s});return(u,R)=>(D(),M("div",{class:"mj-md","data-theme":u.theme},[B(Z,{doms:w.value},null,8,["doms"])],8,z))}});export{K as _};
