import{d as z,a as i,c as A,o as u,b as r,e as c,C as D,H as I,W as L,F as x,l as g,s as T,v as p,_ as F}from"./index-C8_KvqLc.js";import{m as b}from"./MjMessage-B6PxiNxc.js";import{r as B}from"./index-D0LXxPA_.js";const K={class:"caiyan-title"},V={class:"caiyan-ipts"},q=["readonly"],H=["disabled"],N={class:"caiyan-paragraph"},R={class:"caiyan-paragraph"},U=z({__name:"CaiTitle",props:{type:{},showAuthor:{type:Boolean,default:!1}},setup(E){const f=/[\u4e00-\u9fff0-9a-zA-Z]+/,_=E,y=i(localStorage.getItem(`caiyan-${_.type}`)),v=i([]),h=i([]),w=i([]),C=async()=>{var e;s.value="",m.value=[],d.value=new Set,o.value=!1;const a=await B({url:`/caiyan/${_.type}/${y.value}.json`}),l=((e=a.content.paragraphs)==null?void 0:e[0])||[];_.showAuthor&&l.unshift(a.author),v.value=l.filter(t=>!!t).map(t=>t.split("").map(n=>({text:n,show:!f.test(n),isText:f.test(n)}))),h.value=a.title.split("").map(t=>({text:t,show:!f.test(t),isText:f.test(t)}))},$=async(a=!1)=>{w.value.length===0&&(w.value=await B({url:"/caiyan/baike/sum.json"})),(!y.value||a)&&(y.value=w.value[Math.floor(Math.random()*w.value.length)],localStorage.setItem("caiyan-baike",y.value)),await C()};$();const s=i(""),k=A(()=>{let a=0,l=0;const e=new Set;return h.value.forEach(t=>e.add(t.text)),v.value.forEach(t=>{t.forEach(n=>{n.isText&&(a++,e.add(n.text),n.show&&l++)})}),{allText:e,allLen:a,len:l}}),m=i([]),d=i(new Set),o=i(!1),S=()=>{if(!(s.value.length!==1||o.value)){if(d.value.has(s.value))b.warning("你已经猜过这个字");else if(d.value.add(s.value),k.value.allText.has(s.value)){for(let a=0;a<v.value.length;a++)for(let l=0;l<v.value[a].length;l++){const e=v.value[a][l];e.text===s.value&&(e.show=!0)}for(let a=0;a<h.value.length;a++){const l=h.value[a];l.text===s.value&&(l.show=!0,h.value.every(e=>e.show)&&(o.value=!0,b.success("你赢了")))}}else b.warning("没有这个字"),m.value.push(s.value);s.value=""}},M=()=>{s.value="",m.value=[],d.value=new Set,o.value=!1,$(!0)};return(a,l)=>(u(),r("div",K,[c("div",V,[D(c("input",{class:"caiyan-ipt","onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e),onKeydown:L(S,["enter"]),readonly:o.value},null,40,q),[[I,s.value]]),c("button",{class:"caiyan-btn",onClick:S,disabled:s.value.length!==1||o.value},"猜",8,H),c("button",{class:"caiyan-btn",onClick:M},"换一个"),c("button",{class:"caiyan-btn",onClick:C},"重置")]),c("div",N,[(u(!0),r(x,null,g(h.value,(e,t)=>(u(),r("div",{class:T(["text-cell",{"text-cell-show":e.show,"text-cell-normal":!e.isText}]),key:`answer-${t}`},p(e.show||o.value?e.text:""),3))),128))]),(u(!0),r(x,null,g(v.value,(e,t)=>(u(),r("div",{class:"caiyan-paragraph",key:`paragraphs-${t}`},[(u(!0),r(x,null,g(e,(n,j)=>(u(),r("div",{class:T(["text-cell",{"text-cell-show":n.show,"text-cell-win":o.value,"text-cell-normal":!n.isText}]),key:`text-${t}-${j}`},p(n.show||o.value?n.text:""),3))),128))]))),128)),c("div",R,[(u(!0),r(x,null,g(m.value,e=>(u(),r("div",{class:T(["text-cell","text-cell-error"]),key:`text-err-${e}`},p(e),1))),128))]),c("div",null," 你已经猜了 "+p(d.value.size)+" 次，"+p(Math.floor(k.value.len*1e4/(k.value.allLen||1))/100)+"% ",1)]))}}),J=F(U,[["__scopeId","data-v-42320683"]]);export{J as C};
