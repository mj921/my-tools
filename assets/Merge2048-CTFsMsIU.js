import{d as F,a as d,j as G,y as W,o as k,b as S,e as n,G as E,v as $,F as T,l as R,n as B,p as H,g as K,_ as V}from"./index-C8_KvqLc.js";import{m as q}from"./MjMessage-B6PxiNxc.js";const J=x=>(H("data-v-ed4ecc83"),x=x(),K(),x),P=J(()=>n("dt",null,"2048",-1)),Q=J(()=>n("p",null,"方向键、W/A/S/D、鼠标或手指滑动屏幕来控制数字移动",-1)),Z=[P,Q],z={class:"merge2048-bar-btns"},ee={class:"merge2048-scores"},ae={class:"merge2048-score"},te={class:"merge2048-board"},le=F({__name:"Merge2048",setup(x){const I=localStorage.getItem("merge2048");let p={4:{hightScore:0,score:0,arr:[],lv:1},6:{hightScore:0,score:0,arr:[],lv:1},8:{hightScore:0,score:0,arr:[],lv:1},prev:4};if(I)try{p=JSON.parse(I)}catch{}const f=d(p),m=p[p.prev],g=d(m.score),w=d(m.hightScore),r=d(p.prev),b=d(Math.pow(2,m.lv)),i=d(m.lv),M=[6917,3018,64,1],y=d(M.slice(0,m.lv).reduce((a,e)=>a+e,0)),s=d([]),N=(a=1)=>{for(let e=0;e<a;e++){let l=Math.floor(Math.random()*r.value*r.value),o=Math.floor(l/r.value),t=l%r.value;for(;s.value[o][t]!==0;)l=Math.floor(Math.random()*r.value*r.value),o=Math.floor(l/r.value),t=l%r.value;if(i.value<=2)s.value[o][t]=2;else{let u=Math.random()*y.value;for(let c=3;c<Math.min(6,i.value)&&u>0;c++)u-=M[c-2],u<=0&&(s.value[o][t]=Math.pow(2,c-1));u>0&&(s.value[o][t]=2)}}},_=(a=!1)=>{const e=f.value[r.value];s.value=[];for(let l=0;l<r.value;l++){const o=[];for(let t=0;t<r.value;t++)o.push(e.arr[l*r.value+t]||0);s.value.push(o)}a&&N()};_(f.value[r.value].arr.length===0);const j=()=>{f.value[r.value]={hightScore:w.value,score:g.value,arr:s.value.reduce((a,e)=>[...a,...e],[]),lv:i.value},localStorage.setItem("merge2048",JSON.stringify(f.value))},L=(a,e=!1)=>{if(e)r.value=a,g.value=0,b.value=2,i.value=1,y.value=M[0],f.value[r.value].arr=[],_(!0),j();else if(a!==r.value){const l=p[a];g.value=l.score,w.value=l.hightScore,r.value=a,i.value=l.lv,b.value=Math.pow(2,i.value),y.value=M.slice(0,i.value).reduce((o,t)=>o+t,0),_(f.value[r.value].arr.length===0),f.value.prev=a,j()}},C=a=>{let e=0,l=!1;for(let o=1;o<r.value;o++)if(a[o]!==0)for(let t=o-1;t>=e;t--)if(a[t]===0)a[t]=a[t+1],a[t+1]=0,l=!0;else if(a[t]===a[t+1]){a[t]*=2,a[t]>b.value&&(b.value=a[t],i.value=Math.log2(b.value),i.value<6&&i.value>2&&(y.value=M.slice(0,i.value-1).reduce((u,c)=>u+c,0))),g.value+=a[t],g.value>w.value&&(w.value=g.value),a[t+1]=0,e=t+1,l=!0;break}else break;return l},U=()=>{const a=[[],[],[],[]];for(let e=0;e<r.value;e++){const l=[[],[],[],[]];for(let o=0;o<r.value;o++)l[0].push(s.value[o][e]),l[1].push(s.value[e][o]),l[2].push(s.value[r.value-1-o][e]),l[3].push(s.value[e][r.value-1-o]);a[0].push(l[0]),a[1].push(l[1]),a[2].push(l[2]),a[3].push(l[3])}for(let e=0;e<r.value;e++)for(let l=0;l<4;l++)if(C(a[l][e]))return!1;return!0},v=a=>{const e=[];let l=!1;for(let o=0;o<r.value;o++){const t=[];for(let u=0;u<r.value;u++){let c=-1;switch(a){case"up":c=s.value[u][o];break;case"left":c=s.value[o][u];break;case"down":c=s.value[r.value-1-u][o];break;case"right":c=s.value[o][r.value-1-u];break}t.push(c)}e.push(t)}for(let o=0;o<r.value;o++)C(e[o])&&(l=!0);if(l){for(let o=0;o<r.value;o++)for(let t=0;t<r.value;t++)switch(a){case"up":s.value[t][o]=e[o][t];break;case"left":s.value[o][t]=e[o][t];break;case"down":s.value[r.value-1-t][o]=e[o][t];break;case"right":s.value[o][r.value-1-t]=e[o][t];break}N(),j()}U()&&q.error("游戏结束")},h=d(null),O=a=>{switch(a.key){case"ArrowUp":case"w":v("up");break;case"ArrowLeft":case"a":v("left");break;case"ArrowDown":case"s":v("down");break;case"ArrowRight":case"d":v("right");break}},X=a=>{h.value={x:a.clientX,y:a.clientY}},Y=a=>{if(h.value){const e=a.clientX-h.value.x,l=a.clientY-h.value.y;e!==0&&l!==0&&(Math.abs(e)>Math.abs(l)?e>0?v("right"):v("left"):l>0?v("down"):v("up")),h.value=null}},A=a=>{h.value={x:a.changedTouches[0].clientX,y:a.changedTouches[0].clientY}},D=a=>{if(h.value){const e=a.changedTouches[0].clientX-h.value.x,l=a.changedTouches[0].clientY-h.value.y;e!==0&&l!==0&&(Math.abs(e)>Math.abs(l)?e>0?v("right"):v("left"):l>0?v("down"):v("up")),h.value=null}};return G(()=>{window.addEventListener("keyup",O),window.addEventListener("mousedown",X),window.addEventListener("mouseup",Y),window.addEventListener("touchstart",A),window.addEventListener("touchend",D)}),W(()=>{window.removeEventListener("keyup",O),window.removeEventListener("mousedown",X),window.removeEventListener("mouseup",Y),window.removeEventListener("touchstart",A),window.removeEventListener("touchend",D)}),(a,e)=>(k(),S("div",{"data-body-overflow":"hidden",class:"merge2048",style:B({"--merge2048-cols":r.value,"--merge2048-gap":`${6-r.value/2}px`})},[n("div",{class:"merge2048-title",onMousedown:e[0]||(e[0]=E(()=>{},["stop"])),onTouchstart:e[1]||(e[1]=E(()=>{},["stop"]))},Z,32),n("div",{class:"merge2048-bar",onMousedown:e[6]||(e[6]=E(()=>{},["stop"])),onTouchstart:e[7]||(e[7]=E(()=>{},["stop"]))},[n("dl",z,[n("button",{style:{color:"hsl(120, 100%, 40%)"},onClick:e[2]||(e[2]=l=>L(4))},"4 x 4"),n("button",{style:{color:"hsl(240, 100%, 40%)"},onClick:e[3]||(e[3]=l=>L(6))},"6 x 6"),n("button",{style:{color:"hsl(0, 100%, 40%)"},onClick:e[4]||(e[4]=l=>L(8))},"8 x 8")]),n("dl",ee,[n("div",ae,[n("div",null,"当前分数："+$(g.value),1),n("div",null,"最高分数："+$(w.value),1)]),n("button",{onClick:e[5]||(e[5]=l=>L(r.value,!0))},"重新开始")])],32),n("div",te,[(k(!0),S(T,null,R(s.value,(l,o)=>(k(),S(T,null,[(k(!0),S(T,null,R(l,(t,u)=>(k(),S("div",{class:"merge2048-cell",key:`cell-${o}-${u}`},[n("div",{class:"merge2048-content",style:B({borderRadius:Math.max(3,(t||"").toString().length)/3*8+"px",width:Math.max(3,(t||"").toString().length)/3*100+"%",height:Math.max(3,(t||"").toString().length)/3*100+"%",lineHeight:Math.max(3,(t||"").toString().length)/3*2,transform:`scale(${3/Math.max(3,(t||"").toString().length)})`,color:`hsl(${(360*10+120-Math.log2(t||1)*18)%360}, 100%, 40%)`})},$(t||""),5)]))),128))],64))),256))])],4))}}),se=V(le,[["__scopeId","data-v-ed4ecc83"]]);export{se as default};
