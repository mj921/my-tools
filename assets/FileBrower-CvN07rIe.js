import{d as D,a as v,j as N,y as R,o,b as i,e as u,F as y,f,w,E as p,l as A,z as m,n as k,m as E,t as x,s as O,G as b,v as S,_ as U}from"./index-C8_KvqLc.js";import{_ as z}from"./MjTree.vue_vue_type_style_index_0_lang-C1u82sRu.js";import{M as B}from"./MjButton-BmN55pLQ.js";import{_ as H}from"./MjMd.vue_vue_type_style_index_0_lang-Ca3UJ58x.js";import{_ as q}from"./MjPre.vue_vue_type_style_index_0_lang-C0WN2G5J.js";import{M as G}from"./MjSlider-CnvDmUfS.js";import{_ as I}from"./CloseIcon.vue_vue_type_script_setup_true_lang-BO1-knco.js";import"./RightIcon.vue_vue_type_script_setup_true_lang-BCkZ8AjK.js";import"./DownIcon.vue_vue_type_script_setup_true_lang-CXD0Fd_i.js";import"./LoadingIcon.vue_vue_type_script_setup_true_lang-Cjl4ccjb.js";import"./index-C1s-hTSf.js";import"./MjMessage-B6PxiNxc.js";const K={class:"file-brower"},P={class:"file-wrapper"},J={class:"file-content"},Q={class:"file-content-tabs-wrapper"},W={class:"file-content-tabs"},X=["onClick"],Y={key:0,class:"file-content-show"},Z=["src"],ee=["src"],ae=["src"],te=D({__name:"FileBrower",props:{showBase64:{type:Boolean,default:!1}},setup(C){const{query:{opacity:L}}=E(),F=C,c=v([]),n=v([]),e=v(""),s=v({}),$=()=>{c.value=[],n.value=[],e.value="",s.value={}},M=a=>{e.value=a},T=()=>{n.value=[],e.value=""},h=a=>{const t=n.value.indexOf(a);t>-1&&(t>0?e.value=n.value[t-1]:n.value.length>1?e.value=n.value[t+1]:e.value="",n.value.splice(t,1),delete s.value[a])},V=async()=>{const a=await window.showDirectoryPicker(),t={title:a.name,isLeaf:a.kind==="file",key:"/"+a.name,children:[],handle:a};c.value.push(t)},j=async a=>{if(a.isLeaf){if(n.value.includes(a.key)){e.value=a.key;return}const t=await a.handle.getFile(),l={type:"text",lang:"",name:t.name,content:"",key:a.key,opacity:100};if(t.type.includes("image/"))l.type="url",l.content=URL.createObjectURL(t),l.opacity=100,s.value[a.key]=l,n.value.push(a.key),e.value=a.key;else{const r=new FileReader;r.onload=d=>{var g;l.content=(((g=d==null?void 0:d.target)==null?void 0:g.result)||"").toString(),/\.md$/.test(t.name)?(l.type="md",l.opacity=100):(l.opacity=F.showBase64?+(L||"0"):100,l.type="text"),/\.css$/.test(t.name)?l.lang="css":l.lang="",s.value[a.key]=l,n.value.push(a.key),e.value=a.key},r.readAsText(t)}}else{for await(let[,t]of a.handle){const l={title:t.name,isLeaf:t.kind==="file",key:a.key+"/"+t.name,children:[],handle:t};a.children.push(l)}a.children.sort((t,l)=>t.title<l.title?-1:1)}},_=a=>{switch(a.key){case"ArrowLeft":if(e.value&&n.value.length>0){const t=n.value.indexOf(e.value);t>0?e.value=n.value[t-1]:e.value=n.value[n.value.length-1]}break;case"ArrowRight":if(e.value&&n.value.length>0){const t=n.value.indexOf(e.value);t<n.value.length-1?e.value=n.value[t+1]:e.value=n.value[0]}break;case"Backspace":h(e.value);break}};return N(()=>{window.addEventListener("keyup",_)}),R(()=>{window.removeEventListener("keyup",_)}),(a,t)=>(o(),i("div",K,[u("div",P,[c.value.length>0?(o(),i(y,{key:0},[f(z,{data:c.value,"bg-color":"rgb(24,24,24)","text-color":"rgb(204,204,204)","load-more":j},null,8,["data"]),f(B,{onClick:$},{default:w(()=>[x("清空")]),_:1})],64)):(o(),p(B,{key:1,onClick:V},{default:w(()=>[x("选择文件夹")]),_:1}))]),u("div",J,[u("div",Q,[u("div",W,[(o(!0),i(y,null,A(n.value,l=>(o(),i("div",{class:O({"file-content-tab":!0,"file-content-tab--active":l===e.value}),key:l,onClick:r=>M(l),onContextmenu:b(T,["prevent"])},[u("span",null,S(s.value[l].name),1),f(I,{onClick:b(r=>h(l),["stop"])},null,8,["onClick"])],42,X))),128))])]),e.value&&s.value[e.value]?(o(),i("div",Y,[s.value[e.value].type==="url"?(o(),i("img",{key:0,src:s.value[e.value].content},null,8,Z)):s.value[e.value].type==="md"?(o(),p(H,{key:1,content:s.value[e.value].content},null,8,["content"])):s.value[e.value].type==="text"?(o(),i(y,{key:2},[a.showBase64?(o(),p(G,{key:0,"active-color":"orange",style:{"margin-left":"20px",width:"200px"},modelValue:s.value[e.value].opacity,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value[e.value].opacity=l)},null,8,["modelValue"])):m("",!0),a.showBase64&&/^data:image\/[^;]*;base64,/.test(s.value[e.value].content)?(o(),i("img",{key:1,src:s.value[e.value].content,style:k({opacity:s.value[e.value].opacity/100})},null,12,ee)):a.showBase64&&/^https?:\/\/.+\.(jpg|jpeg|png|svg|bmpgif|webp)/.test(s.value[e.value].content)?(o(),i("img",{key:2,src:s.value[e.value].content,style:k({opacity:s.value[e.value].opacity/100})},null,12,ae)):(o(),p(q,{key:3,value:s.value[e.value].content,lang:s.value[e.value].lang,style:k({opacity:s.value[e.value].opacity/100})},null,8,["value","lang","style"]))],64)):m("",!0)])):m("",!0)])]))}}),fe=U(te,[["__scopeId","data-v-1c5351e6"]]);export{fe as default};
