var b=Object.defineProperty;var z=(p,n,t)=>n in p?b(p,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[n]=t;var c=(p,n,t)=>z(p,typeof n!="symbol"?n+"":n,t);import{c as R}from"./index-C1s-hTSf.js";import{S as T,R as I}from"./RectShape-Dx93Qlty.js";import{T as B}from"./TextShape-DgsKKXbf.js";import{R as M}from"./RingShape-ygHJY8pK.js";import{d as y,a as m,x as j,j as N,y as O,o as E,b as w,e as P,f as k,_ as V}from"./index-C8_KvqLc.js";class ${constructor(){c(this,"dpr",3);c(this,"colors",["#5470c6","#92cc76","#fac858","#ef6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"])}}class U extends ${constructor(t){super();c(this,"shapeRender");c(this,"options");c(this,"shapeList",[]);this.shapeRender=new T({ele:t,dpr:this.dpr})}setOption({radius:t,startAngle:s,endAngle:h,...l}){var o;const r={...this.options||{radius:[0,"75%"],data:[],startAngle:90,endAngle:450},...l};t&&(r.radius=Array.isArray(t)?t.length>1?t:[0,t[0]]:[0,t]),(s||h)&&(r.startAngle=(s||r.startAngle)%360,r.endAngle=((o=this.options)==null?void 0:o.endAngle)||r.startAngle+360,h&&(r.endAngle=h%360,r.endAngle<r.startAngle&&(r.endAngle+=360))),this.options=r,this.render()}calcRadius(t,s){return typeof t=="number"?R(t,0,s):typeof t=="string"?/^\d+(\.\d+)?%$/.test(t)?Math.floor(R(Number(t.replace("%","")),0,100)*s/100):/^\d+(\.\d+)?(px)?/.test(t)?Math.floor(R(Number(t.replace("px","")),0,s)):0:0}render(){const{radius:t,data:s,startAngle:h,endAngle:l}=this.options;this.shapeRender.clear(),this.shapeRender.setCanvasSize();const r=this.shapeRender.width/this.dpr,o=this.shapeRender.height/this.dpr,L=Math.min(r,o);let u=this.calcRadius(t[0],L/2),i=this.calcRadius(t[1],L/2);u>i&&([i,u]=[u,i]);const C=s.reduce((d,e)=>d+e.value,0);let g=0;const f=l-h;s.forEach((d,e)=>{var v,_,A;const S=g+d.value/C;this.shapeList[e]?(this.shapeList[e].legendShape.update({x:20,y:20+e*24,width:24,height:12,radius:4,fillColor:this.colors[e%this.colors.length]}),this.shapeList[e].legendTextShape.update({x:50,y:20+e*24,fontSize:14,text:d.name,fillColor:this.colors[e%this.colors.length]}),this.shapeList[e].ringShape.update({rx:r/2,ry:o/2,innerRadius:u,outerRadius:i,startAngle:g*f+h,endAngle:S*f+h,fillColor:this.colors[e%this.colors.length]})):(this.shapeList.push({legendShape:new I({x:20,y:20+e*24,width:24,height:12,radius:4,fillColor:this.colors[e%this.colors.length],dpr:this.dpr}),legendTextShape:new B({x:50,y:20+e*24,fontSize:14,text:d.name,fillColor:this.colors[e%this.colors.length],dpr:this.dpr}),ringShape:new M({rx:r/2,ry:o/2,innerRadius:u,outerRadius:i,startAngle:g*f+h,endAngle:S*f+h,fillColor:this.colors[e%this.colors.length],dpr:this.dpr})}),this.shapeList[e].legendShape.addEventListener("mouseenter",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i+5}),this.shapeList[e].ringShape.zIndex=1,(a=this.shapeRender)==null||a.render()}),this.shapeList[e].legendShape.addEventListener("mouseout",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i}),this.shapeList[e].ringShape.zIndex=0,(a=this.shapeRender)==null||a.render()}),this.shapeList[e].legendTextShape.addEventListener("mouseenter",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i+5}),this.shapeList[e].ringShape.zIndex=1,(a=this.shapeRender)==null||a.render()}),this.shapeList[e].legendTextShape.addEventListener("mouseout",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i}),this.shapeList[e].ringShape.zIndex=0,(a=this.shapeRender)==null||a.render()}),this.shapeList[e].ringShape.addEventListener("mouseenter",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i+5}),this.shapeList[e].ringShape.zIndex=1,(a=this.shapeRender)==null||a.render()}),this.shapeList[e].ringShape.addEventListener("mouseout",()=>{var a;this.shapeList[e].ringShape.update({outerRadius:i}),this.shapeList[e].ringShape.zIndex=0,(a=this.shapeRender)==null||a.render()}),(v=this.shapeRender)==null||v.addShape(this.shapeList[e].legendShape),(_=this.shapeRender)==null||_.addShape(this.shapeList[e].legendTextShape),(A=this.shapeRender)==null||A.addShape(this.shapeList[e].ringShape)),g=S});let x=this.shapeList.length-1;for(;x>s.length;){const d=this.shapeList.pop();x--,d&&(this.shapeRender.removeShape(d.legendShape),this.shapeRender.removeShape(d.legendTextShape),this.shapeRender.removeShape(d.ringShape))}this.shapeRender.render()}}const D={class:"mj-chart mj-chart-pie"},H=y({__name:"MjPie",props:{data:{},radius:{default:"75%"},startAngle:{default:90},endAngle:{}},setup(p){const n=m(),t=p,s=m(null),h=()=>{n.value&&(s.value?s.value.render():(s.value=new U(n.value),s.value.setOption({radius:t.radius,startAngle:t.startAngle,endAngle:t.endAngle,data:t.data})),console.log(s.value))};j([t],()=>{h()},{immediate:!1});const l=m(new ResizeObserver(()=>{h()}));return N(()=>{n.value&&l.value.observe(n.value)}),O(()=>{l.value.disconnect()}),(r,o)=>(E(),w("div",D,[P("canvas",{ref_key:"chartRef",ref:n},null,512)]))}}),W={class:"pie-example"},q=y({__name:"PieExample",setup(p){const n=m([{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]);return(t,s)=>(E(),w("div",W,[k(H,{data:n.value,radius:"50%","start-angle":180,"end-angle":360},null,8,["data"])]))}}),Y=V(q,[["__scopeId","data-v-445b6d93"]]);export{Y as default};
